name: Build OpenWrt X86

on:
  workflow_dispatch:      # 手动触发
  push:
    branches:
      - main              # 推送到 main 分支时触发

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
      - name: Checkout
        uses: actions/checkout@v3
        # 拉取仓库源码

      - name: Update feeds
        run: |
          ./scripts/feeds update -a
          ./scripts/feeds install -a
        # 更新 OpenWrt 软件包源

      - name: Load custom config
        run: |
          [ -e .config ] && echo "Using existing .config"
        # 使用你仓库里的 .config

      - name: Compile
        run: |
          make defconfig
          make -j$(nproc) download V=s
          make -j$(nproc) V=s
        # 编译固件（多线程加速）

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: OpenWrt-x86_64
          path: bin/targets/x86/64/*
          retention-days: 14
        # 上传编译结果到 GitHub Actions 的 Artifacts
